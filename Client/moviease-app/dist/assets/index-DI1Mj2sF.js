import{g as A,A as O,r as S,d as K,u as U,s as b,j as n,S as G,f as F,C as I}from"./index-B8SK9KFa.js";import{a as z}from"./shows-D_KgacHe.js";import{h as Y}from"./moment-C5S46NFB.js";import{p as _}from"./index-D7kOV_Yk.js";import{C as W}from"./index-Bh-oo75p.js";const Z=async o=>{try{return(await A.post(`${O}/bookings`,o)).data}catch(t){return t.response.message}},V=async o=>{try{return(await A.post(`${O}/payment`,o)).data}catch{}};var E={};Object.defineProperty(E,"__esModule",{value:!0});var D=Object.assign||function(o){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(o[e]=r[e])}return o},X=function(){function o(t,r){for(var e=0;e<r.length;e++){var s=r[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,r,e){return r&&o(t.prototype,r),e&&o(t,e),t}}(),J=S,x=T(J),q=_,a=T(q);function T(o){return o&&o.__esModule?o:{default:o}}function C(o,t,r){return t in o?Object.defineProperty(o,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):o[t]=r,o}function Q(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function $(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:o}function ee(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var y=!1,R=!1,L=!1,w=function(o){ee(t,o);function t(r){Q(this,t);var e=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));return e.onScriptLoaded=function(){t.stripeHandler||(t.stripeHandler=StripeCheckout.configure({key:e.props.stripeKey}),e.hasPendingClick&&e.showStripeDialog())},e.onScriptError=function(){for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];e.hideLoadingDialog(),e.props.onScriptError&&e.props.onScriptError.apply(e,i)},e.onClosed=function(){for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];e._isMounted&&e.setState({open:!1}),e.props.closed&&e.props.closed.apply(e,i)},e.onOpened=function(){for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];e.setState({open:!0}),e.props.opened&&e.props.opened.apply(e,i)},e.getConfig=function(){return["token","image","name","description","amount","locale","currency","panelLabel","zipCode","shippingAddress","billingAddress","email","allowRememberMe","bitcoin","alipay","alipayReusable"].reduce(function(s,i){return D({},s,e.props.hasOwnProperty(i)&&C({},i,e.props[i]))},{opened:e.onOpened,closed:e.onClosed})},e.onClick=function(){if(!e.props.disabled)if(L)try{throw new Error("Tried to call onClick, but StripeCheckout failed to load")}catch{}else t.stripeHandler?e.showStripeDialog():(e.showLoadingDialog(),e.hasPendingClick=!0)},e.handleOnMouseDown=function(){e.setState({buttonActive:!0})},e.handleOnMouseUp=function(){e.setState({buttonActive:!1})},e.state={open:!1,buttonActive:!1},e}return X(t,[{key:"componentDidMount",value:function(){var e=this;if(this._isMounted=!0,!R&&!y){y=!0;var s=document.createElement("script");typeof this.props.onScriptTagCreated=="function"&&this.props.onScriptTagCreated(s),s.src="https://checkout.stripe.com/checkout.js",s.async=1,this.loadPromise=function(){var i=!1,l=new Promise(function(f,u){s.onload=function(){R=!0,y=!1,f(),e.onScriptLoaded()},s.onerror=function(h){L=!0,y=!1,u(h),e.onScriptError(h)}}),j=new Promise(function(f,u){l.then(function(){return i?u({isCanceled:!0}):f()}),l.catch(function(h){return u(i?{isCanceled:!0}:h)})});return{promise:j,cancel:function(){i=!0}}}(),this.loadPromise.promise.then(this.onScriptLoaded).catch(this.onScriptError),document.body.appendChild(s)}}},{key:"componentDidUpdate",value:function(){y||this.updateStripeHandler()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.loadPromise&&this.loadPromise.cancel(),t.stripeHandler&&this.state.open&&t.stripeHandler.close()}},{key:"updateStripeHandler",value:function(){(!t.stripeHandler||this.props.reconfigureOnUpdate)&&(t.stripeHandler=StripeCheckout.configure({key:this.props.stripeKey}))}},{key:"showLoadingDialog",value:function(){if(this.props.showLoadingDialog){for(var e=arguments.length,s=Array(e),i=0;i<e;i++)s[i]=arguments[i];this.props.showLoadingDialog.apply(this,s)}}},{key:"hideLoadingDialog",value:function(){if(this.props.hideLoadingDialog){for(var e=arguments.length,s=Array(e),i=0;i<e;i++)s[i]=arguments[i];this.props.hideLoadingDialog.apply(this,s)}}},{key:"showStripeDialog",value:function(){this.hideLoadingDialog(),t.stripeHandler.open(this.getConfig())}},{key:"renderDefaultStripeButton",value:function(){return x.default.createElement("button",D({},C({},this.props.triggerEvent,this.onClick),{className:this.props.className,onMouseDown:this.handleOnMouseDown,onFocus:this.handleOnMouseDown,onMouseUp:this.handleOnMouseUp,onMouseOut:this.handleOnMouseUp,onBlur:this.handleOnMouseUp,style:D({},{overflow:"hidden",display:"inline-block",background:"linear-gradient(#28a0e5,#015e94)",border:0,padding:1,textDecoration:"none",borderRadius:5,boxShadow:"0 1px 0 rgba(0,0,0,0.2)",cursor:"pointer",visibility:"visible",userSelect:"none"},this.state.buttonActive&&{background:"#005d93"},this.props.style)}),x.default.createElement("span",{style:D({},{backgroundImage:"linear-gradient(#7dc5ee,#008cdd 85%,#30a2e4)",fontFamily:'"Helvetica Neue",Helvetica,Arial,sans-serif',fontSize:14,position:"relative",padding:"0 12px",display:"block",height:30,lineHeight:"30px",color:"#fff",fontWeight:"bold",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.25)",textShadow:"0 -1px 0 rgba(0,0,0,0.25)",borderRadius:4},this.state.buttonActive&&{color:"#eee",boxShadow:"inset 0 1px 0 rgba(0,0,0,0.1)",backgroundImage:"linear-gradient(#008cdd,#008cdd 85%,#239adf)"},this.props.textStyle)},this.props.label))}},{key:"renderDisabledButton",value:function(){return x.default.createElement("button",{disabled:!0,style:{background:"rgba(0,0,0,0.2)",overflow:"hidden",display:"inline-block",border:0,padding:1,textDecoration:"none",borderRadius:5,userSelect:"none"}},x.default.createElement("span",{style:{boxShadow:"inset 0 1px 0 rgba(255,255,255,0.25)",fontFamily:'"Helvetica Neue",Helvetica,Arial,sans-serif',fontSize:14,position:"relative",padding:"0 12px",display:"block",height:30,lineHeight:"30px",borderRadius:4,color:"#999",background:"#f8f9fa",textShadow:"0 1px 0 rgba(255,255,255,0.5)"}},this.props.label))}},{key:"render",value:function(){this.props.desktopShowModal===!0&&!this.state.open?this.onClick():this.props.desktopShowModal===!1&&this.state.open&&t.stripeHandler.close();var e=this.props.ComponentClass;return this.props.children?x.default.createElement(e,D({},C({},this.props.triggerEvent,this.onClick),{children:this.props.children})):this.props.disabled?this.renderDisabledButton():this.renderDefaultStripeButton()}}]),t}(x.default.Component);w.defaultProps={className:"StripeCheckout",label:"Pay With Card",locale:"auto",ComponentClass:"span",reconfigureOnUpdate:!1,triggerEvent:"onClick"};w.propTypes={desktopShowModal:a.default.bool,triggerEvent:a.default.oneOf(["onClick","onTouchTap","onTouchStart"]),label:a.default.string,style:a.default.object,textStyle:a.default.object,disabled:a.default.bool,ComponentClass:a.default.string,showLoadingDialog:a.default.func,hideLoadingDialog:a.default.func,onScriptError:a.default.func,onScriptTagCreated:a.default.func,reconfigureOnUpdate:a.default.bool,stripeKey:a.default.string.isRequired,token:a.default.func.isRequired,name:a.default.string,description:a.default.string,image:a.default.string,amount:a.default.number,locale:a.default.oneOf(["auto","zh","da","nl","en","fr","de","it","ja","no","es","sv"]),currency:a.default.oneOf(["AED","AFN","ALL","AMD","ANG","AOA","ARS","AUD","AWG","AZN","BAM","BBD","BDT","BGN","BIF","BMD","BND","BOB","BRL","BSD","BWP","BZD","CAD","CDF","CHF","CLP","CNY","COP","CRC","CVE","CZK","DJF","DKK","DOP","DZD","EEK","EGP","ETB","EUR","FJD","FKP","GBP","GEL","GIP","GMD","GNF","GTQ","GYD","HKD","HNL","HRK","HTG","HUF","IDR","ILS","INR","ISK","JMD","JPY","KES","KGS","KHR","KMF","KRW","KYD","KZT","LAK","LBP","LKR","LRD","LSL","LTL","LVL","MAD","MDL","MGA","MKD","MNT","MOP","MRO","MUR","MVR","MWK","MXN","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","PAB","PEN","PGK","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SBD","SCR","SEK","SGD","SHP","SLL","SOS","SRD","STD","SVC","SZL","THB","TJS","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","UYU","UZS","VND","VUV","WST","XAF","XCD","XOF","XPF","YER","ZAR","ZMW"]),panelLabel:a.default.string,zipCode:a.default.bool,billingAddress:a.default.bool,shippingAddress:a.default.bool,email:a.default.string,allowRememberMe:a.default.bool,bitcoin:a.default.bool,alipay:a.default.oneOf(["auto",!0,!1]),alipayReusable:a.default.bool,opened:a.default.func,closed:a.default.func};w._isMounted=!1;var te=E.default=w;function re(){const o=K(),[t,r]=S.useState(null),[e,s]=S.useState([]),[i,l]=S.useState(!0),j=U();S.useEffect(()=>{window.scroll(0,0)},[]),S.useEffect(()=>{B()},[]);const f=async d=>{const m=t.ticketPrice*e.length,p=await V({token:d,amount:m,show:t,selectedSeats:e});p.success?(b.success("Payment Successful"),u(p.data)):b.error("Payment Unsuccessful")},u=async d=>{const m={show:t._id,seats:[...e],transactionId:d},p=await Z(m);p.success?(b.success("Booking Created Successfully"),b.success("Booking details have been sent to your Email ID"),s(()=>[]),setTimeout(()=>{j("/home")},3e3)):b.error(p.message)},h=()=>{let d=20,m=120,p=Math.ceil(m/d),M=[];for(let c=0;c<p;c++)M.push(c);let k=[];for(let c=0;c<d;c++)k.push(c);const H=c=>{if(!t.bookedSeats.includes(c)){if(e.includes(c)){const v=e.filter(P=>P!==c);s(()=>v);return}s([...e,c])}};return n.jsxs("div",{className:"seating",children:[n.jsxs("div",{className:"screen",children:[n.jsx("hr",{}),n.jsx("hr",{}),n.jsx("hr",{}),n.jsx("p",{className:"pt-2 text-[14px] pb-2",children:"Screen this side, you will be watching in this direction"})]}),n.jsx("div",{className:"seating-arrangement",children:M.map((c,v)=>n.jsxs("div",{children:[k.map(P=>{let g=c*d+P+1,N="seat-btn";return g>m?null:(t.bookedSeats.includes(g)&&(N+=" booked"),e.includes(g)&&(N+=" selected"),n.jsx("button",{onClick:()=>H(g),className:N,children:g},g))}),n.jsx("br",{})]},v))}),e.length>0?n.jsxs("div",{className:"bg-white shadow-lg p-4 rounded-md w-full max-w-screen-md mx-auto",children:[n.jsxs("div",{className:"mb-4",children:[n.jsx("h3",{className:"text-lg font-semibold",children:"Selected Seats"}),n.jsx("div",{className:"overflow-y-auto h-14 border rounded p-2",children:e.map((c,v)=>n.jsx("span",{className:"inline-block text-center w-[40px] bg-blue-50 text-blue-600 px-2 py-1 rounded-full m-1 text-[13px] font-medium",children:c},v))})]}),n.jsxs("div",{className:"flex justify-between items-center sticky bottom-0 bg-white p-4 border-t",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-xl font-semibold",children:"Total Price"}),n.jsxs("p",{className:"text-lg text-red-500 font-bold",children:["Rs. ",t.ticketPrice*e.length,"/-"]})]}),e.length>0&&n.jsx("div",{className:"stripe-checkout",children:n.jsx(te,{stripeKey:"pk_test_51PlbPIRwGirPAie9HtthGBzkM04CxRmvijvqQwe1uzz3MPiMvgP1UBY3m1gFLIb6vJXXFamGbq3mEukxZhpj9nAJ00S2HxaKeW",token:f})})]})]}):n.jsx("div",{children:n.jsx("h3",{className:"titles pt-2",children:"Select seats to proceed"})})]})},B=async()=>{l(!0);const d=await z(o.id);d.success?r(()=>d.data):b.error("Unable to fetch show details!"),l(!1)};return n.jsx("div",{className:"mt-[65px]",children:i?n.jsx("div",{className:"flex justify-center items-center h-screen",children:n.jsx(G,{size:"large"})}):t&&n.jsx("div",{children:n.jsx(F,{children:n.jsx(I,{span:24,children:n.jsx(W,{title:n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold pb-2",children:t.movie.title}),n.jsxs("p",{children:["Theatre : ",t.theatre.name,", ",t.theatre.address]})]}),extra:n.jsxs("div",{className:"flex flex-col gap-2 py-4 text-[16px]",children:[n.jsxs("h4",{children:[n.jsxs("span",{className:"font-medium text-zinc-400",children:["Show Name :"," "]}),n.jsx("span",{className:"font-medium",children:t.name})]}),n.jsxs("h4",{children:[n.jsxs("span",{className:"font-medium text-zinc-400",children:["Show time:"," "]}),n.jsxs("span",{className:"font-medium",children:[Y(t.date).format("Do MMM YYYY")," ",t.time]})]}),n.jsxs("h4",{children:[n.jsxs("span",{className:"font-medium text-zinc-400",children:["Ticket Price :"," "]}),n.jsx("span",{className:"font-medium",children:t.ticketPrice+"/-"})]}),n.jsxs("h4",{children:[n.jsxs("span",{className:"font-medium text-zinc-400",children:["Total Seats :"," "]}),n.jsxs("span",{className:"font-medium",children:[t.totalSeats," ","|"," "]}),n.jsxs("span",{className:"font-medium text-zinc-400",children:["Available Seats :"," "]})," ",n.jsx("span",{className:"font-medium",children:t.totalSeats-t.bookedSeats.length})]})]}),children:h()})})})})})}export{re as default};
